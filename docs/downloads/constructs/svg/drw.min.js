/*!
 * VERSION: 0.0.2
 * DATE: 2017-05-06
 * UPDATES AND DOCS AT: https://chris-moody.github.io/mkr
 *
 * @license copyright 2017 Christopher C. Moody
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy of
 *  this software and associated documentation files (the "Software"), to deal in the
 *  Software without restriction, including without limitation the rights to use, copy,
 *  modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,
 *  and to permit persons to whom the Software is furnished to do so, subject to the
 *  following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 *  INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 *  PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 *  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 *  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * @author: Christopher C. Moody, chris@moodydigital.com
 */
!function(global,className){var _instances={},_count=-1,drw=function(options){options=options||{},_count++;var id=this._id=options.id||className+"-"+_count;this._parent=mkr.getDefault(options,"parent",document.body),mkr.setDefault(options,"svg",{}),mkr.setDefault(options.svg,"attr",{}),mkr.setDefault(options.svg.attr,"class","drw-svg"),mkr.setDefault(options.svg.attr,"width","100%"),mkr.setDefault(options.svg.attr,"height","100%"),mkr.setDefault(options.svg,"css",{}),mkr.setDefault(options.svg.css,"overflow","visible"),this._svg=options.svgRoot||mkr.create("svg",options.svg,this._parent),this._drawData={},this._drawData.fill=mkr["default"](options.fill,"transparent"),this._drawData.stroke=mkr["default"](options.stroke,"#000000"),this._drawData["stroke-width"]=mkr["default"](options.strokeWidth,1),this._init(),_instances[id]=this};drw.prototype={get svg(){return this._svg},get fill(){return this._drawData.fill},set fill(value){this._drawData.fill=value},get stroke(){return this._drawData.stroke},set stroke(value){this._drawData.stroke=value},get strokeWidth(){return this._drawData.strokeWidth},set strokeWidth(value){this._drawData["stroke-width"]=value},_init:function(){this._lastX=this._lastY=0},_checkPath:function(d){this.newPath(d)},newPath:function(d){d=d||"";var pathData=mkr.merge(this._drawData,{d:d});this._next=null,this._last=this._path=mkr.create("path",{attr:pathData},this._svg)},end:function(close){if(this._path){var _path=this._path;if(this._path=null,close){var path=_path.getAttribute("d").split(" ");path.push("Z"),TweenMax.set(_path,{attr:{d:path.join(" ")}})}}},circle:function(x,y,r){return this.ellipse(x,y,r,r)},ellipse:function(x,y,rx,ry){this.end();var data=mkr.merge(this._drawData,{cx:x,cy:y,rx:rx,ry:ry});return this._last=mkr.create("ellipse",{attr:data},this._svg),this._last},triangle:function(){},rect:function(x,y,w,h){this.end();var data=mkr.merge(this._drawData,{x:x,y:y,width:w,height:h});return this._last=mkr.create("rect",{attr:data},this._svg),this._last},polygon:function(points){this.end();for(var pts="",i=0;i<points.length;i++)pts=points[i]+(i%2==0?",":" ");console.log(pts);var data=mkr.merge(this._drawData,{points:pts});return this._last=mkr.create("polygon",{attr:data},this._svg),this._last},_move:function(x,y){this._checkPath();var path=this._path.getAttribute("d").split(" ");return path.push("M",x,y),TweenMax.set(this._path,{attr:{d:path.join(" ")}})},qdrtc:function(cx,cy,x,y){this._checkPath(["M",cx,cy].join(" "));var path=this._path.getAttribute("d").split(" ");return path.push("Q",cx,cy,x,y),TweenMax.set(this._path,{attr:{d:path.join(" ")}})},curve:function(cx1,cy1,cx2,cy2,x,y){this._checkPath(["M",cx1,cy1].join(" "));var path=this._path.getAttribute("d").split(" ");return path.push("C",cx1,cy1,cx2,cy2,x,y),TweenMax.set(this._path,{attr:{d:path.join(" ")}})},arcTo:function(duration,start,length,vars,r,cx,cy,icx,icy,iR,iStart,iLength){r=mkr["default"](r,50),iR=mkr["default"](iR,r),start=mkr["default"](start,0),iStart=mkr["default"](iStart,start),length=mkr["default"](length,360),iLength=mkr["default"](iLength,0),cx=mkr["default"](cx,this._lastX),icx=mkr["default"](icx,this._lastX),cy=mkr["default"](cy,this._lastY),icy=mkr["default"](icy,this._lastY);{var end=start+length,rad2=((end-90)*(Math.PI/180),(start-90)*(Math.PI/180));cx+r*Math.cos(rad2),cy+r*Math.sin(rad2)}end=iStart+iLength;{var iRad1=(end-90)*(Math.PI/180);(iStart-90)*(Math.PI/180)}cx-=r*Math.cos(iRad1),cy-=r*Math.sin(iRad1),icx-=iR*Math.cos(iRad1),icy-=iR*Math.sin(iRad1),this.arc(icy,icy,iR,iStart,iLength);var p=drw.calculateArc(cx,cy,r,start,length);this._lastX=p[1],this._lastY=p[2];var prefix=["M"].join(" "),tVars={cx:cx,cy:cy,r:r,start:start,length:length},targetPath=this._last,target={cx:icx,cy:icy,r:iR,start:iStart,length:iLength};return vars.onUpdate=function(){var newArc=drw.calculateArc(target.cx,target.cy,target.r,target.start,target.length);newArc.splice(0,1);var d=prefix+" "+newArc.join(" ");TweenMax.set(targetPath,{attr:{d:d}})},[TweenMax.to(this._path,duration,vars),TweenMax.to(target,duration,tVars)]},arc:function(cx,cy,r,start,length){this._checkPath();var path=drw.calculateArc(cx,cy,r,start,length);return this._path._mkrarcdata={cx:cx,cy:cy,r:r,start:start,length:length,path:path},TweenMax.set(this._path,{attr:{d:path.join(" ")}})},lineTo:function(duration,x,y,vars,fromX,fromY){return fromX=mkr["default"](fromX,this._lastX),fromY=mkr["default"](fromY,this._lastY),this._lastX=x,this._lastY=y,this.line(fromX,fromY),vars=vars||{},vars.attr=vars.attr||{},vars.attr.d=["M",fromX,fromY,"L",x,y].join(" "),TweenMax.to(this._path,duration,vars)},line:function(x,y){this._checkPath(["M",x,y].join(" "));var path=this._next||this._path.getAttribute("d");return path=path.split(" "),path.push("L",x,y),this._next=path=path.join(" "),TweenMax.to(this._path,0,{attr:{d:path}})}},drw.calcArcFrom=function(x,y,r,start,length){length%360==0&&0!=length&&(length+=359.999*(length/Math.abs(length))),length%=360;var end=start+length,rad1=(end-90)*(Math.PI/180),rad2=(start-90)*(Math.PI/180),cx=x-r*Math.cos(rad1),cy=y-r*Math.sin(rad1),x2=cx+r*Math.cos(rad2),y2=cy+r*Math.sin(rad2),largeArcFlag=180>=length?0:1,sweepFlag=0;return["M",x,y,"A",r,r,0,largeArcFlag,sweepFlag,x2,y2]},drw.calculateArc=function(cx,cy,r,start,length){length%360==0&&0!=length&&(length+=359.999*(length/Math.abs(length))),length%=360;var end=start+length,rad1=(end-90)*(Math.PI/180),rad2=(start-90)*(Math.PI/180),x1=cx+r*Math.cos(rad1),y1=cy+r*Math.sin(rad1),x2=cx+r*Math.cos(rad2),y2=cy+r*Math.sin(rad2),largeArcFlag=180>=length?0:1,sweepFlag=0;return["M",x1,y1,"A",r,r,0,largeArcFlag,sweepFlag,x2,y2]},drw.splitPath=function(path,cmd){cmd=cmd||"A-Z";var n=path.search(new RegExp("["+cmd+"](?!.*["+cmd+"])","gi"));return 0>n?[n,"",path,""]:[n,path[n],path.substr(0,n+1),path.substr(n+2)]},drw.getInstance=function(id){return _instances[id]},Object.defineProperty(drw,"VERSION",{get:function(){return"0.0.2"}}),"function"==typeof define&&define.amd?define(function(){return drw}):"undefined"!=typeof module&&module.exports?module.exports=drw:global[className]=drw}(mkr._constructs,"drw");